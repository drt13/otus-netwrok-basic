# Проектная работа по курсу Network Engineer. Basic
### Тема: Построение отказоустойчивой локальной сети

[1. Цели проекта](#1-цели-проекта)

[2. Проектирование сети](#2-проектирование-сети)

[3. Маршрутизация](#3-маршрутизация)

[4. Настройка коммутаторов](#4-настройка-коммутаторов)

[5. Межвлановая маршрутизация](#5-межвлановая-маршрутизация)

[6. Механизмы сетевой безопасности](#6-механизмы-сетевой-безопасности)

[7. Проверка и тестирование](#7-проверка-и-тестирование)

[8. Результаты и оценка](#8-результаты-и-оценка)

### 1. Цели проекта
Проект направлен на создание иерархической сети, включающей меры по резервированию на каждом уровне.

- Иерархическая модель с резервированием
- Два провайдера
- Беспроводные сети
- VLAN и подсети
- Маршрутизация OSPF
- DHCP и статические IP
- SSH-доступ и PAT

### 2. Проектирование сети

#### 2.1 Топология

![](/final/img/topology.PNG)

Проект реализован в Cisco Packet Tracer - [выгрузка](otus_final.pkt). 
Локальная сеть включает в себя три уровня: уровень ядра, уровень распределения и уровень доступа. На уровне ядра избыточность устанавливается путем развертывания двух маршрутизаторов и двух L3-коммутаторов, соединенных между собой для обеспечения бесперебойной маршрутизации. Уровень распределения включает в себя L2-коммутаторы, отвечающие за подключение отделов, каждому из которых назначен свой VLAN. На уровне доступа подключаются устройства конечных пользователей, такие как ПК и точки доступа.

#### 2.2 IP-адресация
**Базовая сеть** - 192.168.0.0/22

| Отдел             | Сеть         | Маска            |
|-------------------|--------------|------------------|
| Отдел продаж      |192.168.10.0  | 255.255.255.0    |
| Отдел Кадров      |192.168.20.0  | 255.255.255.0    |
| Бухгалтерия       |192.168.30.0  | 255.255.255.0    |
| Администрация     |192.168.40.0  | 255.255.255.0    |
| ИТ                |192.168.50.0  | 255.255.255.0    |
| Серверная         |192.168.60.0  | 255.255.255.0    |

**IP-адреса для устройств в серверной прописывются в ручную**

**Маршрутизаторы и L3-коммутаторы**
| X                 | Сеть         | Маска              |
|-------------------|--------------|------------------  |
| CORE R1 - SW1     |10.10.10.0    | 255.255.255.252    |
| CORE R1 - SW2     |10.10.10.4    | 255.255.255.252    |
| CORE R2 - SW1     |10.10.10.8    | 255.255.255.252    |
| CORE R1 - SW2     |10.10.10.12   | 255.255.255.252    |

**IP-адрес между ядром и провайдером:**
103.133.254.0/30
103.133.254.4/30
103.133.254.8/30
103.133.254.12/30

### 3. Маршрутизация
[конфиги устройств](configs)
#### 3.1 Базовая настройка маршрутизаторов
Ниже приведена базовая настройка маршрутизатора CORE-R2, настрйоки для других коммутаторов аналогичны
```r
conf t #Переход в режим глобальной конфигурации
hostname CORE-R2 #Устанавливает имя CORE-R2
line console 0 #Переход в режим настройки консольной линии
password cisco # Устанавливает пароль консоли в "cisco"
login # Позволяет войти в систему через консоль
exit # Выход из режима настройки консольной линии
enable password cisco # Устанавливает пароль "cisco" для привилегированного режима
no ip domain-lookup # Отключает функцию разрешения имен
banner motd #NO Unauthorised Access!!!# 
service password-encryption # Включает шифрование паролей
do wr # Writes the configuration to memory
ip domain name cisco.net # Настраивает доменное имя для разрешения DNS
username admin password cisco # Создает пользователя admin с паролем cisco
crypto key generate rsa # Генерирует пару ключей RSA для SSH
1024 # Устанавливает размер ключа в 1024 бит
line vty 0 15 # Вход в режим конфигурации vty
login local # Включает локальную аутентификацию для линий VTY
transport input ssh # Рарешает ssh для удаленного подключения
ip ssh version 2 # Устанавливает 2 версию SSH
do wr # Запись конфигурации в память
exit # Выход из режима глобальной конфигурации
```

#### 3.2 Статическая и динамическая маршрутизация
Статические маршруты настроены на маршрутизаторах для направления трафика к выделенным DHCP-серверам, размещённым в серверной. Это гарантирует постоянный, заранее заданный маршрут для внутреннего сетевого взаимодействия.
Динамическая маршрутизация - OSPF (Open Shortest Path First), внедрена для обеспечения автоматического выбора маршрутов и адаптации к изменениям топологии сети. OSPF позволяет выполнять конвергенцию маршрутов в режиме реального времени, что обеспечивает высокую гибкость и масштабируемость сетевой инфраструктуры.

```r
Настройка OSPF на L3-коммутаторах и маршрутизаторах
-------------------------------
========
L3
========
ip routing
router ospf 10
router-id 2.2.2.2
network 192.168.10.0 0.0.0.255 area 0
network 192.168.20.0 0.0.0.255 area 0
network 192.168.30.0 0.0.0.255 area 0
network 192.168.40.0 0.0.0.255 area 0
network 192.168.50.0 0.0.0.255 area 0
network 192.168.60.0 0.0.0.255 area 0
network 10.10.10.0 0.0.0.3 area 0
network 10.10.10.8 0.0.0.3 area 0
do wr

===========
ROUTER
===========
router ospf 10
router-id 3.3.3.3
network 10.10.10.0 0.0.0.3 area 0
network 10.10.10.4 0.0.0.3 area 0
network 103.133.254.0 0.0.0.3 area 0
network 103.133.254.8 0.0.0.3 area 0
do wr
exit

=============
ISP
=============
router ospf 10
router-id 5.5.5.5
network 103.133.254.0 0.0.0.3 area 0
network 103.133.254.4 0.0.0.3 area 0
do wr
exit
```

```r
# Маршруты по умолчанию
=========================
ROUTER
=========================
ip route 0.0.0.0 0.0.0.0 se0/2/0
ip route 0.0.0.0 0.0.0.0 se0/2/1 70
do wr

=========================
L3
=========================
ip route 0.0.0.0 0.0.0.0 gig1/0/1
ip route 0.0.0.0 0.0.0.0 gig1/0/2 70
do wr
```

```r
# Назначение IP-адресов на интерфейсах маршрутизатора
=======================================
 ROUTER
=======================================
int gig0/0
ip address 10.10.10.1 255.255.255.252
no shutdown
int gig0/1
ip address 10.10.10.5 255.255.255.252
no shutdown
int se0/2/0
ip address 103.133.254.1 255.255.255.252
no shutdown
clock rate 64000
int se0/2/1
ip address 103.133.254.10 255.255.255.252
no shutdown
clock rate 64000
exit
do wr

======================================
ISP
======================================
int se0/3/0
ip address 103.133.254.1 255.255.255.252
no shutdown
int se0/3/1
ip address 103.133.254.5 255.255.255.252
no shutdown
exit
do wr
```

### 4. Настройка коммутаторов.
Основные настройки коммутаторов, конфигурация VLAN (10–60) и назначение портов. Настроены транковый и access-режимы. Коммутаторы на уровне доступа обслуживают устройства сотрудников.

#### 4.1 Базовая настойка коммутаторов
Ниже приведена настройка L2-коммутатора для бухгалтерии. Настройки на других коммутаторов аналогичны.
```r
hostname Finance-SW
line console 0
password cisco
login
exit
enable password cisco
no ip domain-lookup
banner motd #No Unauthorised Acces!!!#
service password-encryption
do wr
ip domain name cisco.net
username admin password cisco
crypto key generate rsa
1024
line vty 0 15
login local
transport input ssh
exit
ip ssh version 2
do wr
```

#### 4.2 Настройка VLAN
В рамках проекта VLAN применяются для разделения отделов компании, таких как Отдел продаж (VLAN 10) и Отдел кадров (VLAN 20). Каждому VLAN присваивается имя и она ассоциируется с конкретными портами коммутатора с помощью команды `switchport access vlan`.

Такая сегментация повышает уровень сетевой безопасности, уменьшает объём широковещательного трафика и упрощает администрирование сети. Конфигурация VLAN выполняется на каждом коммутаторе, что обеспечивает структурированную и безопасную сетевую инфраструктуру.

```r
# Настройка Vlan`ов на коммутаторах
==================
L2 
==================
int range fa0/1-2
switchport mode trunk
exit
vlan 30
name Finance
vlan 99
name BlackHole
exit
int range fa0/3-24
switchport mode access
switchport access vlan 30
exit
int range gig0/1-2
switchport mode access
switchport access vlan 99
shutdown
exit
do wr

================
L3
================
int range gig1/0/3-8
switchport mode trunk
vlan 10
name Sales
vlan 20
name HR
vlan 30
name Finance
vlan 40
name Admin
vlan 50
name ICT
vlan 60
name ServerRoom
exit
do wr
```

### 5. Межвлановая маршрутизация
Реализована с использованием SVIs на L3-коммутаторах. Указаны IP-адреса для каждой VLAN, указаны DHCP-адреса помощников.

#### 5.1 Настройка межвлановой маршрутизации на L3-коммутаторах
```r
Inter-VLAN L3
-------------------
int vlan 10
no shutdown
ip address 192.168.10.1 255.255.255.0
ip helper-address 192.168.60.2
exit
int vlan 20
no shutdown
ip address 192.168.20.1 255.255.255.0
ip helper-address 192.168.60.2
exit
int vlan 30
no shutdown
ip address 192.168.30.1 255.255.255.0
ip helper-address 192.168.60.2
exit
int vlan 40
no shutdown
ip address 192.168.40.1 255.255.255.0
ip helper-address 192.168.60.2
exit
int vlan 50
no shutdown
ip address 192.168.50.1 255.255.255.0
ip helper-address 192.168.60.2
exit
int vlan 60
no shutdown
ip address 192.168.60.1 255.255.255.0
exit
do wr
```

#### 5.2 Разбиение на подсети
Базовая сеть 192.168.0.0/22 была разбита на подсети для различных отделов компании. Например, VLAN 10 использует подсеть 192.168.10.0/24, а VLAN 20 — 192.168.20.0/24.
Это позволяет каждому VLAN`у иметь собственный диапазон IP-адресов, исключая перекрытие адресного пространства.

### 6. Механизмы сетевой безопасности
#### 6.1 ACL
 Списки контроля доступа (ACL) применяются на маршрутизаторах для фильтрации трафика на основе заданных критериев, таких как IP-адреса источника и назначения, номера портов и используемые протоколы.
```r
ACL
------------------
# пример списка контроля доступа, который разрешает трафик от VLAN 10 (подсеть 192.168.10.0/24) к VLAN 20 (192.168.20.0/24) и запрещает всё остальное:
access-list 100 permit ip 192.168.10.0 0.0.0.255 192.168.20.0 0.0.0.255
access-list 100 deny ip any any
# Применение ACL к интерфейсу
interface vlan 10
ip access-group 100 in
exit
```

#### 6.2 NAT, PAT
В проекте используются механизмы NAT и PAT.

NAT (Network Address Translation) применяется на маршрутизаторе для преобразования внутренних частных IP-адресов во внешний публичный IP-адрес при выходе в интернет. Это обеспечивает сокрытие внутренней адресации, повышает уровень безопасности и позволяет использовать ограниченное количество публичных IP-адресов.

PAT (Port Address Translation), как разновидность NAT, позволяет нескольким внутренним устройствам использовать один внешний IP-адрес, различая соединения по номерам портов. Это особенно эффективно при массовом выходе клиентских устройств в интернет с использованием единого внешнего интерфейса.

```r
NAT
-------------
ip nat inside source list 1 int se0/2/0 overload
ip nat inside source list 1 int se0/2/1 overload
access-list 1 permit 192.168.10.0 0.0.0.255
access-list 1 permit 192.168.20.0 0.0.0.255
access-list 1 permit 192.168.30.0 0.0.0.255
access-list 1 permit 192.168.40.0 0.0.0.255
access-list 1 permit 192.168.50.0 0.0.0.255
access-list 1 permit 192.168.60.0 0.0.0.255
int range gig0/0-1
ip nat inside
exit
int se0/2/0
ip nat outside
int se0/2/1
ip nat outside
exit
do wr
```

#### 6.3 Port Security
Port Security — это функция, реализуемая на коммутаторах для ограничения доступа к сети путём контроля количества разрешённых MAC-адресов на конкретном порту коммутатора.

Данный механизм позволяет предотвратить подключение неавторизованных устройств, усиливая безопасность локальной сети.

В проекте Port Security применяется в сегменте отдела бухгалтерии следующим образом:
```r
interface range fastEthernet0/3-24 # Определяет диапазон портов коммутатора
switchport port-security maximum 1 # Устанавливает максимальное количество портов на 1
switchport port-security mac-address sticky # Включает режим sticky MAC для динамического закрепления MAC-адресов
switchport port-security violation shutdown # отключение порта при попытке несанкционированного подключения
```

В данной конфигурации:

* `interface range fastEthernet0/3-24`: Указывает диапазон портов коммутатора Fast Ethernet с 3 по 24, относящихся к сегменту финансового отдела.

* `switchport port-security maximum 1`: Ограничивает количество разрешённых MAC-адресов на каждом порту до одного. Это мера безопасности, направленная на то, чтобы к каждому порту подключалось не более одного устройства.

* `switchport port-security mac-address sticky`: Включает механизм sticky MAC-адресов. При его активации коммутатор автоматически закрепляет MAC-адрес подключённого устройства, тем самым устраняя необходимость ручной настройки.

* `switchport port-security violation shutdown`: Настраивает реакцию на нарушение политики безопасности — в случае превышения допустимого количества MAC-адресов порт будет переведён в состояние ошибки (err-disabled) и автоматически отключён. Это предотвращает подключение неавторизованных устройств.

Данная конфигурация обеспечивает, что к каждому порту в сети финансового отдела может быть подключено только одно устройство с определённым MAC-адресом.
Если фиксируется нарушение (например, попытка подключения второго устройства), порт автоматически блокируется, что создаёт дополнительный уровень защиты сети.

### 7. Проверка и тестирование
Проверка подключения, адресации DHCP, маршрутизации, ACL, безопасности портов, резервирования.

#### 7.1 Проверка получения ip по DHCP
![](img/dhcp.PNG)

![](img/dhcp2.PNG)

#### 7.2 Проверка избыточности и механизмов отказоустойчивости
Иерархическая структура сети с реализованной избыточностью на каждом уровне — включая резервные маршрутизаторы, коммутаторы уровня распределения (L3-коммутаторы), а также подключения к нескольким провайдерам — была протестирована для проверки работы механизмов отказоустойчивости и обеспечения высокой надёжности сети.
![](img/trace.PNG)

#### 7.3 Проверка Port Security
При подключении к порту другого устройства порт блокируется
![](img/portsec.PNG)

#### 7.4 Проверка подлкючения по SSH
Подключение к маршрутизатору R1

![](img/ssh1.PNG)

![](img/ssh2.PNG)

### 8. Результаты и оценка
Проект достиг всех целей:
- Иерархия
- Резервирование
- VLAN и маршрутизация
- Безопасность
- NAT и PAT
- Возможность масштабирования
- Надёжность